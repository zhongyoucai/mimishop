<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>{:config('web_site_title')}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="{:config('theme_path')}/wap/css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="{:config('theme_path')}/wap/css/icons-extra.css" />
		<link rel="stylesheet" type="text/css" href="{:config('theme_path')}/wap/css/login.css" />
		
	</head>

	<body>

		<style>
			.mui-control-content {
				background-color: white;
				min-height: 215px;
			}
			.mui-control-content .mui-loading {
				margin-top: 50px;
			}			
		</style>
		<!-- 头部 -->
		<header class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-left-nav mui-pull-left" style="color: #FF6600;"></a>
			<a class="mui-icon mui-icon-extra mui-icon-extra-class mui-pull-right" style="color: #FF6600;"></a>
			<h1 class="mui-title" style="color:#FF6600">找回密码</h1>
		</header>
		<!-- 头部结束 -->
		<div class="mui-content">
		  <div class="main">
		   <div class="head">
		   	 <a href="{:url('index/index')}"><img  src="{:config('theme_path')}/wap/images/logo1.png" ></a><a href="{:url('base/register')}"><span class="line_left">找回密码</span></a>
		   </div>
		   <form action="" method="POST">
		   <div class="input-login" style="margin-top:60px;">
		   	<div  style="margin-top:-5px !important">
					<input type="password" id="password" class="pass-img prev-pass" placeholder="新密码" />
			</div>
			<div  style="margin-top:-5px !important">
					<input type="password" id="repassword" class="pass-img prev-pass" placeholder="请再次输入密码" />
			</div>
			
			<div  style="margin-top:-5px !important">
					<input type="text" id="pic_code" class="pass-img prev-check-mobile" style="width:60%;" placeholder="请输入图形验证码" /><img class="pic-img" src="{:url('base/captcha')}" onclick="this.src='{:url('base/captcha')}?rand='+Math.random()" style="cursor:pointer" title="点击刷新">
			</div>
			<div style="margin-top:-5px !important">
					<input type="text" class="pass-img prev-mobile" id="mobile" placeholder="请输入你的手机号">
			</div>
			<div  style="margin-top:-5px !important">
					<input type="text" id="sms_code" class="pass-img prev-check-mobile" style="width:60%;" placeholder="请输入手机验证码" /><input type="button"class="pass-img sms-button" onclick="sendSms()" style="padding-left:10px !important;font-size:10px!important;"value="发送验证码" />
			</div>
			
		
			<input type="button" class="login-button" id="submit" value="找回密码" />
			</div>
		   </form>

			<div class="account">
				<a href="{:url('base/login')}"><span style="margin-left:10px;color:#FF6600">返回登录</span></a>
			</div>
			
		  		
		<!-- 底部 -->
		<div style='height: 10px;'></div>
			<div style='height: 80px; margin-top:70px; text-align: center;'>
				<p><a>联系我们</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a>企业介绍</a></p>
				<p>copyright 2016 &nbsp;&nbsp;珍良缘农副食品超商有限公司</p>
			</div>
			<div style='height: 10px;'></div>
		</div>
		</div>
		<!-- 底部结束 -->

<script src="{:config('theme_path')}/wap/js/jquery.min.js"></script>
<script type="text/javascript">

//获取手机验证码
function sendSms(){
  var mobile   = $("#mobile").val();
  var pic_code = $("#pic_code").val();
    if(verifymobile(mobile) == false){
      alert('请填写正确的手机号码')
      return false
    }
    $.ajax({
      type:"post",
      url:"{:url('alidayu/index')}",
      data:{"mobile":mobile,"captcha":pic_code},
      dataType:"json",
      success: function(res){
             if(res.code == 0 )
                   {
                     alert(res.msg);
                   
                   } else{
                        
                          var wait = 60;
                           $(".sms-button").val((--wait) + "秒后重新发送");
                             var time_line = setInterval(function(){
                             if(wait == 0)
                             {
                            
                             $(".sms-button").val("获取手机验证码");
                             return clearInterval(time_line);
                           }
                           else
                           {
                             $(".sms-button").val((--wait) + "秒后重新发送"); 
                           }    
                             },1000);
             alert(res.msg);            
             }
           
               }
                 });
  
}
//手机号验证
function verifymobile(mobile){
  var phone = /^13[0-9]{1}[0-9]{8}$|15[0-9]{1}[0-9]{8}$|18[0-9]{1}[0-9]{8}$|17[0-9]{9}$/;
    if(!phone.test(mobile)){
      return false
    }
}


 </script>

<script type="text/javascript" language="javascript">
// 提交数据
$(function(){
  $("#submit").click(function(){
    var mobile    =$("#mobile").val();
    var password  =$("#password").val();
    var repassword=$("#repassword").val();
    var code      =$("#sms_code").val();
  $.ajax({
     type:'post',
     url:"{:url('base/getPassword')}",
     data:{"password":password,
           "mobile":mobile,   "repassword":repassword,
           "code":code,},
     dataType:'json',
     success: function(data) {
                if (data.code) {
            alert(data.msg);
          setTimeout(function () {
          location.href = data.url;
        }, 1000);
        } else {
            alert(data.msg);
        }
        },
        error: function(request) {
                alert("页面错误");
      }
  });
  
   })
})

</script>
</body>

</html>